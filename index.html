<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waterfall Task Planner</title>
    <link rel="stylesheet" href="obr_planner.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Waterfall Task Planner</h1>
            <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –ø–æ Waterfall-–º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏</p>
        </header>

        <div class="toolbar">
            <button onclick="openAddTaskModal()" class="btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
            <button onclick="openManageExecutorsModal()" class="btn-secondary">üë• –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</button>
            <button onclick="openManageEpicsModal()" class="btn-secondary">üéØ –≠–ø–∏–∫–∏</button>
            <button onclick="openManageFeaturesModal()" class="btn-secondary">üí° –§–∏—á–∏</button>
            <button onclick="calculateSchedule()" class="btn-secondary">üìÖ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
            <button onclick="saveToJSON()" class="btn-secondary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <input type="file" id="load-json" accept=".json" onchange="loadFromJSON(event)" style="display:none;">
            <label for="load-json" class="btn-secondary">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</label>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
        <section class="section filters-section">
            <h3>üîç –§–∏–ª—å—Ç—Ä—ã</h3>
            <div class="filters-container">
                <div class="filter-group">
                    <label for="filter-executor">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</label>
                    <select id="filter-executor" onchange="applyFilters()">
                        <option value="">–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</option>
                    </select>
                    <button onclick="clearExecutorFilter()" class="btn-secondary small">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
                
                <div class="filter-group">
                    <label for="filter-feature">–§–∏—á–∞:</label>
                    <select id="filter-feature" onchange="applyFilters()">
                        <option value="">–í—Å–µ —Ñ–∏—á–∏</option>
                    </select>
                    <button onclick="clearFeatureFilter()" class="btn-secondary small">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
                
                <div class="filter-group">
                    <label for="filter-epic">–≠–ø–∏–∫:</label>
                    <select id="filter-epic" onchange="applyFilters()">
                        <option value="">–í—Å–µ —ç–ø–∏–∫–∏</option>
                    </select>
                    <button onclick="clearEpicFilter()" class="btn-secondary small">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
                
                <div class="filter-group">
                    <label for="filter-priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
                    <select id="filter-priority" onchange="applyFilters()">
                        <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
                        <option value="high">–í—ã—Å–æ–∫–∏–π (7-9)</option>
                        <option value="medium">–°—Ä–µ–¥–Ω–∏–π (4-6)</option>
                        <option value="low">–ù–∏–∑–∫–∏–π (1-3)</option>
                    </select>
                    <button onclick="clearPriorityFilter()" class="btn-secondary small">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
        </section>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á -->
        <section class="section">
            <h2>üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h2>
            <div class="table-container">
                <table id="tasks-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('title')" class="sortable">
                                –ó–∞–¥–∞—á–∞
                                <span class="sort-indicator" id="title-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th onclick="sortTable('duration')" class="sortable">
                                –î–ª–∏—Ç.
                                <span class="sort-indicator" id="duration-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th onclick="sortTable('startDate')" class="sortable">
                                –ù–∞—á–∞–ª–æ
                                <span class="sort-indicator" id="startDate-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th onclick="sortTable('endDate')" class="sortable">
                                –û–∫–æ–Ω—á–∞–Ω–∏–µ
                                <span class="sort-indicator" id="endDate-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th onclick="sortTable('executors')" class="sortable">
                                –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
                                <span class="sort-indicator" id="executors-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th onclick="sortTable('feature')" class="sortable">
                                –§–∏—á–∞
                                <span class="sort-indicator" id="feature-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th onclick="sortTable('priority')" class="sortable">
                                –¶–µ–Ω–Ω–æ—Å—Ç—å
                                <span class="sort-indicator" id="priority-sort">‚ÜïÔ∏è</span>
                            </th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="tasks-tbody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTaskModal()">&times;</span>
            <h2 id="task-modal-title">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
            <form id="task-form" onsubmit="handleTaskSubmit(event)">
                <input type="hidden" id="task-id">
                
                <div class="form-group">
                    <label for="task-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                    <input type="text" id="task-title" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ä–∞–±. –¥–Ω–µ–π)</label>
                        <input type="number" id="task-duration" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="task-start-date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                        <input type="date" id="task-start-date">
                    </div>
                    
                    <div class="form-group">
                        <label for="task-end-date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="date" id="task-end-date" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-start-after">–ù–∞—á–∞—Ç—å –Ω–µ —Ä–∞–Ω—å—à–µ</label>
                        <input type="date" id="task-start-after">
                    </div>
                    
                    <div class="form-group">
                        <label for="task-finish-before">–ó–∞–∫–æ–Ω—á–∏—Ç—å –Ω–µ –ø–æ–∑–∂–µ</label>
                        <input type="date" id="task-finish-before">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-feature">–§–∏—á–∞</label>
                        <select id="task-feature">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏—á—É --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="task-priority">–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å (1-9)</label>
                        <input type="number" id="task-priority" min="1" max="9" value="5">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</label>
                        <div class="selected-items">
                            <div id="selected-executors-list"></div>
                            <button type="button" onclick="openExecutorsModal()" class="btn-secondary small">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</label>
                        <div class="selected-items">
                            <div id="selected-dependencies-list"></div>
                            <button type="button" onclick="openDependenciesModal()" class="btn-secondary small">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="task-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                    <textarea id="task-comments" rows="2"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" onclick="closeTaskModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏ –∑–∞–¥–∞—á–∏ -->
    <div id="executors-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeExecutorsModal()">&times;</span>
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏</h2>
            
            <div class="form-group">
                <label>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</label>
                <select id="available-executors" multiple size="8"></select>
                <div class="modal-buttons">
                    <button onclick="addSelectedExecutors()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å ‚Üí</button>
                    <button onclick="removeSelectedExecutors()" class="btn-secondary">‚Üê –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</label>
                <select id="selected-executors" multiple size="8"></select>
            </div>
            
            <div class="modal-actions">
                <button onclick="saveExecutors()" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onclick="closeExecutorsModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∑–∞–¥–∞—á–∏ -->
    <div id="dependencies-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDependenciesModal()">&times;</span>
            <h2>üîó –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏</h2>
            
            <div class="form-group">
                <label>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏</label>
                <select id="available-dependencies" multiple size="8"></select>
                <div class="modal-buttons">
                    <button onclick="addSelectedDependencies()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å ‚Üí</button>
                    <button onclick="removeSelectedDependencies()" class="btn-secondary">‚Üê –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</label>
                <select id="selected-dependencies" multiple size="8"></select>
            </div>
            
            <div class="modal-actions">
                <button onclick="saveDependencies()" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onclick="closeDependenciesModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏ -->
    <div id="executor-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeExecutorModal()">&times;</span>
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏</h2>
            
            <div class="form-group">
                <label for="new-executor-name">–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</label>
                <input type="text" id="new-executor-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="new-executor-efficiency">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
                    <input type="number" id="new-executor-efficiency" min="0.1" max="2" step="0.1" value="1.0">
                </div>
                
                <div class="form-group">
                    <label for="new-executor-availability">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</label>
                    <select id="new-executor-availability">
                        <option value="true">–î–æ—Å—Ç—É–ø–µ–Ω</option>
                        <option value="false">–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</option>
                    </select>
                </div>
            </div>
            
            <button onclick="addExecutorFromModal()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</button>
            
            <div class="executors-list" id="executors-list-modal"></div>
            
            <div class="modal-actions">
                <button onclick="closeExecutorModal()" class="btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–ø–∏–∫–∞–º–∏ -->
    <div id="epic-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEpicModal()">&times;</span>
            <h2>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–ø–∏–∫–∞–º–∏</h2>
            
            <div class="form-group">
                <label for="new-epic-name">–ù–∞–∑–≤–∞–Ω–∏–µ —ç–ø–∏–∫–∞</label>
                <input type="text" id="new-epic-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–ø–∏–∫–∞">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="new-epic-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="new-epic-description" rows="2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç–ø–∏–∫–∞"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="new-epic-priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-9)</label>
                    <input type="number" id="new-epic-priority" min="1" max="9" value="5">
                </div>
            </div>
            
            <button onclick="addEpicFromModal()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å —ç–ø–∏–∫</button>
            
            <div class="epics-list" id="epics-list-modal"></div>
            
            <div class="modal-actions">
                <button onclick="closeEpicModal()" class="btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∞–º–∏ -->
    <div id="feature-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeFeatureModal()">&times;</span>
            <h2>üí° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏—á–∞–º–∏</h2>
            
            <div class="form-group">
                <label for="new-feature-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—á–∏</label>
                <input type="text" id="new-feature-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—á–∏">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="new-feature-epic">–°–≤—è–∑–∞–Ω–Ω—ã–π —ç–ø–∏–∫</label>
                    <select id="new-feature-epic">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —ç–ø–∏–∫ --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="new-feature-business-value">–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å</label>
                    <input type="number" id="new-feature-business-value" min="1" max="9" value="5">
                </div>
            </div>
            
            <div class="form-group">
                <label for="new-feature-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="new-feature-description" rows="2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏—á–∏"></textarea>
            </div>
            
            <button onclick="addFeatureFromModal()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏—á—É</button>
            
            <div class="features-list" id="features-list-modal"></div>
            
            <div class="modal-actions">
                <button onclick="closeFeatureModal()" class="btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="obr_planner.js"></script>
</body>
</html>